{
  "version": "1.0.0",
  "description": "Performance budget for Magic Box | Relay AI",
  "timestamp": "2025-10-19T00:00:00Z",

  "metrics": {
    "TTFV": {
      "target": 1500,
      "alert": 1200,
      "description": "Time to First Value (Welcome screen ready + input focused)"
    },
    "FCP": {
      "target": 1000,
      "alert": 800,
      "description": "First Contentful Paint (first pixel rendered)"
    },
    "LCP": {
      "target": 2500,
      "alert": 2000,
      "description": "Largest Contentful Paint (hero content visible)"
    },
    "CLS": {
      "target": 0.1,
      "alert": 0.05,
      "description": "Cumulative Layout Shift (visual stability)"
    },
    "TTI": {
      "target": 3000,
      "alert": 2500,
      "description": "Time to Interactive (user can interact)"
    },
    "TBT": {
      "target": 200,
      "alert": 150,
      "description": "Total Blocking Time (main thread responsiveness)"
    }
  },

  "bundles": [
    {
      "name": "index.html",
      "maxSize": "10 KB",
      "gzipSize": "3 KB",
      "description": "HTML structure with inline critical CSS"
    },
    {
      "name": "magic.js",
      "maxSize": "50 KB",
      "gzipSize": "15 KB",
      "description": "Main application logic (deferred loading)"
    },
    {
      "name": "sw.js",
      "maxSize": "5 KB",
      "gzipSize": "1.5 KB",
      "description": "Service Worker for caching strategy"
    },
    {
      "name": "Total Page",
      "maxSize": "60 KB",
      "gzipSize": "18 KB",
      "description": "Total uncompressed vs gzipped"
    }
  ],

  "network": {
    "preconnect": [
      "https://relay-production-f2a6.up.railway.app"
    ],
    "dns-prefetch": [
      "https://relay-production-f2a6.up.railway.app"
    ],
    "compression": {
      "required": "gzip or brotli",
      "minimum": "70% reduction for JS/CSS"
    },
    "caching": {
      "htmlCacheControl": "public, max-age=3600, must-revalidate",
      "staticCacheControl": "public, max-age=31536000, immutable",
      "apiCacheControl": "public, max-age=60"
    }
  },

  "optimizations": {
    "implemented": [
      {
        "name": "Preconnect to API origin",
        "impact": "50-100ms faster",
        "status": "COMPLETE",
        "description": "Added preconnect + dns-prefetch to reduce DNS/TCP latency"
      },
      {
        "name": "Deferred metrics reporting",
        "impact": "50ms unblocked TTFV",
        "status": "COMPLETE",
        "description": "Moved metrics POST to requestIdleCallback to avoid blocking TTFV"
      },
      {
        "name": "CSS optimization",
        "impact": "20-30ms paint time",
        "status": "COMPLETE",
        "description": "Added contain: layout, removed scroll-behavior: smooth, added prefers-reduced-motion"
      },
      {
        "name": "DOM batching",
        "impact": "30-50ms scroll/update latency",
        "status": "COMPLETE",
        "description": "Used requestAnimationFrame to batch DOM updates and reduce layout thrashing"
      },
      {
        "name": "Event listener optimization",
        "impact": "10-20ms init time",
        "status": "COMPLETE",
        "description": "Added passive listeners where possible, debounced textarea resize"
      },
      {
        "name": "Service Worker caching",
        "impact": "500-1000ms+ on repeat visits",
        "status": "COMPLETE",
        "description": "Implemented stale-while-revalidate for HTML, cache-first for assets"
      }
    ],
    "future": [
      {
        "name": "Code splitting",
        "impact": "50-100ms lazy load overhead",
        "effort": "high",
        "description": "Split magic.js into init.js + core.js, lazy-load non-critical features"
      },
      {
        "name": "Image optimization",
        "impact": "N/A (no images currently)",
        "effort": "low",
        "description": "When adding images, use WebP + AVIF with responsive sizing"
      },
      {
        "name": "Streaming response optimization",
        "impact": "20-50ms per chunk",
        "effort": "medium",
        "description": "Implement virtual rendering for long responses"
      }
    ]
  },

  "testing": {
    "devices": [
      "iPhone SE (375px, 5G capable but test on Slow 3G)",
      "Moto G4 (360px, mid-range Android)"
    ],
    "networks": [
      "Slow 3G: 100 kbps (target network for baseline)"
    ],
    "tools": [
      "Chrome Lighthouse (local & CI/CD)",
      "WebPageTest.org (detailed waterfall analysis)",
      "DevTools Performance profiler"
    ]
  },

  "alerts": {
    "ttfv_critical": 2000,
    "fcp_critical": 1500,
    "cls_critical": 0.25,
    "js_error_rate": 0.01,
    "http_error_rate": 0.01
  },

  "notes": [
    "TTFV target of 1.5s is aggressive for Slow 3G (100 kbps) but achievable with minimal JS",
    "Current HTML+CSS overhead is minimal (~3KB gzipped), leaving room for JavaScript",
    "Service Worker benefits repeat visits dramatically (50%+ faster) without impacting first visit",
    "Competitors: ChatGPT ~1.2s, Perplexity ~0.8s, Copilot ~2.0s",
    "Monitor Core Web Vitals continuously; performance degrades over time as features are added"
  ]
}
