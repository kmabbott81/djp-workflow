<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Box | Relay AI</title>

    <!-- Preconnect to critical origins (reduce DNS/TCP latency) -->
    <link rel="preconnect" href="https://relay-production-f2a6.up.railway.app" crossorigin>
    <link rel="dns-prefetch" href="https://relay-production-f2a6.up.railway.app">

    <!-- Critical CSS inline for fastest render -->
    <style>
        /* Reset & Base */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0a0a0b;
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Cost Pill - always visible */
        .cost-pill {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #2a2a2b;
            border: 1px solid #3a3a3b;
            border-radius: 9999px;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 100;
            transition: all 0.2s;
        }

        .cost-pill.streaming {
            border-color: #4a9eff;
            box-shadow: 0 0 10px rgba(74, 158, 255, 0.3);
        }

        .cost-pill .status-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #666;
        }

        .cost-pill.streaming .status-icon {
            background: #4a9eff;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .cost-value { font-weight: 600; color: #4a9eff; }
        .latency-value { color: #888; }
        .token-count { color: #666; font-size: 0.75rem; }

        /* Messages Container */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 2rem 1rem 8rem 1rem;
            scroll-behavior: auto;
            contain: layout style paint;
        }

        .messages-container::-webkit-scrollbar {
            width: 8px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: #1a1a1b;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: #3a3a3b;
            border-radius: 4px;
        }

        /* Message Bubbles */
        .message {
            margin-bottom: 1.5rem;
            max-width: 800px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Reduce animation on slower networks */
        @media (prefers-reduced-motion: reduce) {
            .message, .cost-pill.streaming .status-icon {
                animation: none;
            }
        }

        .message.user {
            margin-left: auto;
        }

        .message-content {
            padding: 1rem 1.25rem;
            border-radius: 12px;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: #2a2a2b;
            border: 1px solid #3a3a3b;
        }

        .message.assistant .message-content {
            background: #1a1a1b;
            border: 1px solid #2a2a2b;
        }

        .message.error .message-content {
            background: #3a1a1b;
            border: 1px solid #ff4444;
            color: #ffaaaa;
        }

        /* Input Area */
        .input-area {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, transparent 0%, #0a0a0b 20%);
            padding: 2rem 1rem 1rem 1rem;
            z-index: 10;
        }

        .input-container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .input-wrapper {
            display: flex;
            gap: 0.5rem;
            background: #1a1a1b;
            border: 2px solid #3a3a3b;
            border-radius: 12px;
            padding: 0.75rem;
            transition: border-color 0.2s;
        }

        .input-wrapper:focus-within {
            border-color: #4a9eff;
        }

        #user-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 1rem;
            outline: none;
            font-family: inherit;
            resize: none;
            min-height: 24px;
            max-height: 200px;
        }

        #send-button {
            background: #4a9eff;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1.25rem;
            color: #ffffff;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            white-space: nowrap;
        }

        #send-button:hover:not(:disabled) {
            background: #3a8eef;
        }

        #send-button:disabled {
            background: #2a2a2b;
            color: #666;
            cursor: not-allowed;
        }

        /* Loading State */
        .skeleton {
            background: linear-gradient(90deg, #2a2a2b 25%, #3a3a3b 50%, #2a2a2b 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Welcome Screen */
        .welcome {
            text-align: center;
            padding: 4rem 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .welcome h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #4a9eff 0%, #6b5eff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome p {
            color: #888;
            font-size: 1.125rem;
            line-height: 1.6;
        }

        /* Anonymous Badge */
        .anon-badge {
            position: fixed;
            top: 1rem;
            left: 1rem;
            background: #2a2a2b;
            border: 1px solid #3a3a3b;
            border-radius: 9999px;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 100;
        }

        .anon-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff9500;
        }

        .usage-bar {
            width: 60px;
            height: 4px;
            background: #3a3a3b;
            border-radius: 2px;
            overflow: hidden;
            margin-left: 0.5rem;
        }

        .usage-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a9eff, #6b5eff);
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <!-- Anonymous Session Badge -->
    <div class="anon-badge" id="anon-badge">
        <span class="anon-icon"></span>
        <span id="anon-status">Anonymous</span>
        <div class="usage-bar">
            <div class="usage-fill" id="usage-fill" style="width: 0%"></div>
        </div>
        <span id="usage-text">0/100</span>
    </div>

    <!-- Cost & Latency Pill -->
    <div class="cost-pill" id="cost-pill">
        <span class="status-icon"></span>
        <span class="cost-value" id="cost-value">$0.000000</span>
        <span class="cost-divider">·</span>
        <span class="latency-value" id="latency-value">0ms</span>
        <span class="token-count" id="token-count">(0 tokens)</span>
    </div>

    <!-- Messages Area -->
    <div class="messages-container" id="messages">
        <div class="welcome">
            <h1>Magic Box</h1>
            <p>Your invisible AI butler. Ask anything, and I'll make it happen—with zero friction and complete transparency.</p>
        </div>
    </div>

    <!-- Input Area -->
    <div class="input-area">
        <div class="input-container">
            <div class="input-wrapper">
                <textarea
                    id="user-input"
                    placeholder="What would you like me to do?"
                    rows="1"
                    autofocus
                ></textarea>
                <button id="send-button">Send</button>
            </div>
        </div>
    </div>

    <!-- Load main JavaScript with deferred execution -->
    <script src="/static/magic/magic.js" defer></script>

    <!-- Register service worker for offline support and caching -->
    <script>
        if ('serviceWorker' in navigator) {
            // Register SW after page loads to not block TTFV
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/magic/sw.js', {
                    scope: '/magic'
                }).catch(err => console.log('[SW] Registration failed:', err));
            });
        }
    </script>
</body>
</html>
